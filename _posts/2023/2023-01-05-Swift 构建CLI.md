---
title: swift ç¼–å†™ç¬¬ä¸€ä¸ªCLIç¨‹åº
tags: swift CLI 
key: 111 
published: true
article_header: 
  type: cover
  image:
    src: https://img.win3000.com/m00/1d/19/a75b5f0fdd91629239b2782e5d3e8ddd.jpg

---

####  ç”¨swift ç¼–å†™ç¬¬ä¸€ä¸ªCLI(command line tool)ç¨‹åº

--------

#### èµ·å› 

å› ä¸ºåœ¨ç ”ç©¶swiftLintçš„æ—¶å€™ï¼Œå‘ç°äº†ç†Ÿæ‚‰çš„swift codeï¼Œä½†å´æ— æ³•ç†è§£åˆ°åº•å®ç°äº†ä»€ä¹ˆï¼Ÿ

å‘ç°swiftlint éƒ½æ˜¯åŸºäºå¼€æºåº“[swift-argument-parser](https://github.com/apple/swift-argument-parser) åšçš„ï¼Œäºæ˜¯ä¹å»äº†è§£appleçš„å¼€æºåº“[swift-argument-parser](https://github.com/apple/swift-argument-parser) ,  ç„¶åæ‰çŸ¥é“äº†ï¼Œè¿™é‡Œé¢è¿˜å¤§æœ‰ç„æœºå˜ï¼

[swift-argument-parser](https://github.com/apple/swift-argument-parser) è¿™ä¸ªæ˜¯ç”¨æ¥è§£æå‘½ä»¤è¡Œå‚æ•°çš„è‹¹æœå¼€æºåº“ï¼Œåº”ç”¨è¿™ä¸ªåº“èƒ½å¾ˆæ–¹ä¾¿çš„è¿›è¡Œå‘½ä»¤è¡Œå‚æ•°è§£æã€‚

åæ¥éå¸¸å¥½å¥‡ï¼Œé‚£ä¹ˆswiftLintå·¥ç¨‹é‡Œçš„Package.swiftæ–‡ä»¶åˆæ˜¯å•¥å‘€ï¼Ÿ

ä¸€ç»ƒçš„ç–‘é—®ï¼Œä¸€å¤´çš„é›¾æ°´ï¼Œäºæ˜¯ä¹æ‰å…¥åˆ°æ¢ç©¶çš„æ·±å‘ä¸­...

ç»è¿‡ä¸€ä¸¤å¤©çš„ç ”ç©¶ï¼Œç¿»çœ‹appleçš„å®˜æ–¹æ–‡æ¡£ã€å¼€æºåº“[swift-argument-parser](https://github.com/apple/swift-argument-parser) çš„ä½¿ç”¨ã€åˆ«äººçš„åšå®¢ï¼Œæœ€åè¿›å…¥äº†å¦ä¸€ä¸ªå¤©åœ°ã€‚ ä¸‹é¢æˆ‘å°†é€ä¸ªè§£å¼€é‡Œè¾¹çš„è°œé¢˜ï¼ˆå½“ç„¶æˆ‘æ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“ï¼Œå› ä¸ºä¹‹å‰æ²¡æ¥è§¦è¿‡...ï¼Œä¸è¦ç¬‘è¯å“¦ğŸ˜„ï¼‰

#### ä¾æ¬¡æ¥è¯´

##### é¦–å…ˆè¯´ä¸€è¯´ï¼Œæˆ‘ä»¬çœ‹åˆ°Package.swiftæ–‡ä»¶

å…¶å®è¿™æ˜¯è‹¹æœæ–°å‡ºçš„ä¸€ç§ä»£ç ç®¡ç†æ–¹æ¡ˆï¼Œå«åšSwift Package Managerï¼Œ ç®€ç§°ä¸ºSPMï¼Œ æˆ‘ä»¬ä¹‹å‰åº”è¯¥å¯¹Cocoapodsã€Carthageï¼ˆä¸“é—¨ç”¨äºswiftå·¥ç¨‹æ— åµŒå…¥å¼å·¥ç¨‹ç®¡ç†ï¼‰éƒ½æ¯”è¾ƒäº†è§£ï¼Œä½†æ˜¯å…¶å®ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼ŒSPMä¹Ÿæ˜¯ç”¨æ¥ç®¡ç†ä¸‰æ–¹åº“çš„ä¾èµ–çš„ã€‚ å¯¹åº”åˆ°æˆ‘ä»¬Cocoapods è¿™ä¸ªPackage.swiftæ–‡ä»¶å°±ç›¸å½“äº.podfileã€‚

é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåˆ›å»ºå‘¢ï¼Ÿ

â€‹	ä¸¤ç§æ–¹å¼å¯ä»¥åˆ›å»ºï¼š

â€‹	1. æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼åˆ›å»ºï¼šswift package init [--type executable]

2. æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰“å¼€xcodeåˆ›å»ºï¼Œ<img src="https://cdn.jsdelivr.net/gh/HaoXianSen/HaoXianSen.github.io@master/screenshots/20230105182358image-20230105181140374.png" alt="image-20230105181140374" style="zoom:33%;" />



è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºå‡ºæ¥è¿™æ ·ä¸€ä¸ªå·¥ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š![image-20230105181534945](https://cdn.jsdelivr.net/gh/HaoXianSen/HaoXianSen.github.io@master/screenshots/20230105182408image-20230105181534945.png)



ç”¨xcode æ‰“å¼€Package.swift å³å¯æ‰“å¼€å·¥ç¨‹ã€‚

ç„¶åæˆ‘ä»¬éœ€è¦é…ç½®Package.swift : 

```swift
import PackageDescription

let package = Package(
    name: "Counter",
    dependencies: [
        // Dependencies declare other packages that this package depends on.
        // .package(url: /* package url */, from: "1.0.0"),
        .package(url: "https://github.com/apple/swift-argument-parser.git", from: "1.0.0")
    ],
    targets: [
        // Targets are the basic building blocks of a package. A target can define a module or a test suite.
        // Targets can depend on other targets in this package, and on products in packages this package depends on.
        .executableTarget(
            name: "Counter",
            dependencies: [.product(name: "ArgumentParser", package: "swift-argument-parser")]),
    ]
)
```



å¦‚æœéœ€è¦äº†è§£æ‰€æœ‰çš„å‚æ•°è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡çœ‹xcode Packageè¿™ä¸ªç»“æ„ä½“äº†è§£ã€‚é‚£å…¶å®ä¸Šæˆ‘ä»¬ç®€å•çš„é…ç½®åŒ…åã€åŒ…åã€ä¾èµ–ã€å¯æ‰§è¡Œç›®æ ‡å·²ç„¶è¶³å¤Ÿã€‚ è¿™æ ·æˆ‘ä»¬çš„ä¸€ä¸ªswift package å°±é…ç½®å®Œæˆäº†ï¼Œå½“é…ç½®å®Œæˆåï¼Œxcodeä¼šè‡ªåŠ¨æ£€æµ‹åŒ…åã€å¯æ‰§è¡Œåå­— å’Œ ç±»åæ˜¯å¦å¯¹åº”ï¼Œä»¥åŠæ£€æµ‹ä¾èµ–å¹¶ä¸”ä¸‹è½½å®‰è£…ã€‚

##### ç´§æ¥ç€æˆ‘ä»¬è¯´è¯´å‘½ä»¤è¡Œèƒ½å¹²ä»€ä¹ˆ

æ¯”å¦‚æˆ‘ä»¬ç”¨çš„gitå‘½ä»¤ã€pod å‘½ä»¤å…¶å®éƒ½æ˜¯å‘½ä»¤è¡Œç¨‹åºã€‚åªæ˜¯ä»–ä»¬å¯èƒ½ä¸æ˜¯ç”¨swiftå®ç°çš„è€Œå·²ï¼Œæ¯”å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„cocapodså°±æ˜¯ç”¨rubyå®ç°ã€‚é‚£ä¹ˆç›¸å¿…è¿™ä¹ˆä¸¾ä¾‹æˆ‘ä»¬å°±çŸ¥é“å‘½ä»¤è¡Œèƒ½å¹²ä»€ä¹ˆï¼Ÿå¯å¹²çš„äº‹æƒ…å¯å¤ªå¤šäº†ï¼Œå½“ç„¶æœ€æ—©è¯´çš„swiftLintä¹Ÿæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºã€‚

##### æ¥ä¸‹æ¥æˆ‘ä»¬æ ¹æ®swift-argument-parser å®˜æ–¹ç¤ºä¾‹ï¼Œå†™ä¸€ä¸ªå°å°çš„CLI

å†™ä¸€ä¸ªç»å…¸çš„ï¼Œè¯»å–aæ–‡ä»¶çš„å†…å®¹å¹¶ç»Ÿè®¡æ–‡ä»¶ä¸­å•è¯çš„æ•°é‡ï¼Œè¾“å‡ºåˆ°bæ–‡ä»¶ã€‚

å¦‚æœä¸ç”¨å¼€æºåº“[swift-argument-parser](https://github.com/apple/swift-argument-parser) ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªmain.swift ä½œä¸ºç¨‹åºçš„å…¥å£:

```swift
// main.swift
let counter = Counter()

do {
   try counter.run()
} catch {
    print("An error occurred")
}
```

å› ä¸ºåŸç”Ÿçš„å‚æ•°è§£ææ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å°±å†™ä¸€ä¸ªæ¯”è¾ƒç®€å•è¾“å‡ºå§ï¼Œ

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªCounterï¼š

```swift
// Counter.swift
import Foundation

public struct Counter {
    private var arguments: [String]
    
    init(arguments: [String] = CommandLine.arguments) {
        self.arguments = arguments
    }
    
    public func run() throws {
        print("test")
    }
}
```

ç„¶åæˆ‘ä»¬å†å½“å‰è·Ÿç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤:` swift build` ,  ç„¶åæˆ‘ä»¬æ‰§è¡Œ` swift run Counter`, å°±å¯ä»¥çœ‹è§ç»ˆç«¯çš„è¾“å‡ºäº†  ![image-20230105184936299](https://cdn.jsdelivr.net/gh/HaoXianSen/HaoXianSen.github.io@master/screenshots/20230105184936image-20230105184936299.png)

è¿™æ ·æˆ‘ä»¬ç®—æ˜¯ä¸€ä¸ªç®€å•çš„CLIå°±å¼€å‘å®Œäº†ã€‚

okï¼Œæˆ‘ä»¬å†ä½¿ç”¨[swift-argument-parser](https://github.com/apple/swift-argument-parser) å»å®ç°ï¼Œæˆ‘ä»¬æœ€åˆçš„ç»Ÿè®¡

ä½¿ç”¨ArgumentParser, æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨ç»™main.swiftå…¥å£ï¼Œåªéœ€è¦å‘½åç±»æˆ–è€…ç»“æ„ä½“ï¼Œç»§æ‰¿ParsableCommand æˆ–è€…AsyncParsableCommandï¼Œç„¶åæ ‡è¯†ä¸º@mainå³å¯ã€‚

ArgumentParser æœ‰ä¸‰ç§ç±»å‹æ ‡è¯†ï¼š @Argument æ ‡è¯†å¿…é¡»çš„å‚æ•°ï¼Œå¸¦æœ‰é¡ºåºçš„, ä¸å¯æŒ‡å®šåå­— @Option æ˜¯æ— åºçš„ï¼Œå¯ä»¥æŒ‡å®šåå­—ã€‚ä»¥åŠæ˜¯å¦ç®€å†™ç­‰ï¼Œ @Flag é€šå¸¸æ˜¯ä¸€ä¸ªboolæŒ‡ï¼Œä¸€ä¸ªæ ‡è¯†ã€‚ä¸‹é¢åˆ†åˆ«ä¸¾ä¾‹è¿™ä¸‰ç§å¯¹åº”åˆ°å‘½ä»¤è¡Œ

```swift
// 1 @Argument
@Argument var inputFile: String
@Argument var outputFile: String
// è¿™ç§æƒ…å†µå¯¹åº”åˆ°å‘½ä»¤è¡Œæˆ‘ä»¬å°±éœ€è¦ Counter test1.txt test2.txt ï¼Œä»¥å±æ€§çš„é¡ºåºç»™å®šå‚æ•°ã€‚å¹¶ä¸”ä¸éœ€è¦æŒ‡å®š

// 2. @Option
@Option var inputFile: String
@Option var outputFile: String
// è¿™ç§æƒ…å†µå¯¹åº”åˆ°å‘½ä»¤è¡Œæˆ‘ä»¬å°±éœ€è¦ Counter --input-file test1.txt --output-file test2.txt ï¼Œå½“ç„¶é¡ºåºå¯ä»¥éšæ„ï¼Œåªè¦æŒ‡å®šå³å¯ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥@Option(name: help:)ç­‰åˆå§‹åŒ–æ–¹æ³•æŒ‡å®šæç¤ºè¯­ã€ç®€å†™ç­‰ç­‰

// 2. @Flag
@Option var inputFile: String
@Option var outputFile: String
@Flag var verbose: Bool = false
// è¿™ç§æƒ…å†µå¯¹åº”åˆ°å‘½ä»¤è¡Œæˆ‘ä»¬å°±éœ€è¦ Counter --verbose --input-file test1.txt --output-file test2.txtã€‚

```

OKï¼Œå¤§æ¦‚swift-argument-parserå°±ä»‹ç»è¿™ä¹ˆå¤šï¼Œå…·ä½“çš„å¯ä»¥æŸ¥çœ‹[github](https://github.com/apple/swift-argument-parser), æˆ–è€…[å®˜ç½‘](https://apple.github.io/swift-argument-parser/documentation/argumentparser/gettingstarted/)å‚è€ƒç”¨æ³•ã€‚



æ¥ä¸‹æ¥æ˜¯æˆ‘ä»¬ç»Ÿè®¡çš„å‘½ä»¤è¡Œå®ç°ï¼š

```swift
import ArgumentParser
import Foundation

@main
struct Counter: ParsableCommand {
    @Option(name: [.short, .customLong("input")], help: "A file to read")
    var inputFile: String
    
    @Option(name: [.short, .customLong("output")], help: "A file to save word counts to")
    var outputFile:String
    
    
    @Flag(name: .shortAndLong, help: "Print status updates while counting") var verbose: Bool = false
    
    mutating func run() throws {
        if verbose {
            print("""
                Counting words in '\(inputFile)' \
                and write result into '\(outputFile)'
                """)
        }
        
        guard let input = try? String(contentsOfFile: inputFile) else {
            throw RuntimeError("Can't read \(inputFile) contents")
        }
        
        let words = input.components(separatedBy: .whitespacesAndNewlines)
            .map { word in
                word.trimmingCharacters(in: CharacterSet.alphanumerics.inverted).lowercased()
            }
            .compactMap { word in
                word.isEmpty ? nil : word
            }
        
        let counts = Dictionary(grouping: words, by: { $0 })
            .mapValues { $0.count }
            .sorted(by: { $0.value > $1.value })
        
        if verbose {
            print("found \(counts.count) words")
        }
        
        let output: String = counts.map { word, count in
            "\(word): \(count)"
        }.joined(separator: "\n")
        
        guard let _ = try? output.write(toFile: outputFile, atomically: true, encoding: .utf8) else {
            throw RuntimeError("Can't write to \(outputFile)")
        }
    }
}

struct RuntimeError: Error, CustomStringConvertible {
    var description: String
    
    init(_ description: String) {
        self.description = description
    }
    
}
```

åœ¨æˆ‘ä»¬ç†è§£äº†ArgumentParserä¹‹åå’Œäº†è§£äº†å‘½ä»¤è¡Œå¼€å‘ä¹‹åï¼Œåœ¨çœ‹è¿™äº›swiftçš„ä»£ç å°±æ¯”è¾ƒç®€å•äº†ã€‚å†™èµ·æ¥ä¹Ÿå¾ˆç®€å•äº†ã€‚



æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š

æ–°å»ºtest1.txtã€test2.txt, åœ¨test1.txté‡ŒåŠ å…¥<img src="https://cdn.jsdelivr.net/gh/HaoXianSen/HaoXianSen.github.io@master/screenshots/20230105190718image-20230105190717915.png" alt="image-20230105190717915" style="zoom:50%;" />

ç„¶åï¼Œæ‰§è¡Œ swift run Counter -i test1.txt -o test2.txt -v, æŸ¥çœ‹è¾“å‡º

![image-20230105190933826](https://cdn.jsdelivr.net/gh/HaoXianSen/HaoXianSen.github.io@master/screenshots/20230105190934image-20230105190933826.png)

æˆ‘ä»¬æŸ¥çœ‹test2.txtæ–‡ä»¶

![image-20230105191015159](https://cdn.jsdelivr.net/gh/HaoXianSen/HaoXianSen.github.io@master/screenshots/20230105191015image-20230105191015159.png)

ç¡®å®ä¹Ÿå†™è¿›å»äº†ã€‚

æˆ‘ä»¬çš„å‘½ä»¤ç°åœ¨åªèƒ½åœ¨å½“å‰å·¥ç¨‹ç›®å½•ä¸‹ï¼Œå¹¶ä¸”é€šè¿‡swift runå‘½ä»¤æ‰§è¡Œï¼Œå¦‚ä½•ä½¿å¾—å‘½ä»¤åœ¨ä»»ä½•ç›®å½•ç»ˆç«¯éƒ½å¯ä»¥æ‰§è¡Œï¼Ÿ

æˆ‘ä»¬éœ€è¦æ‰“ä¸€ä¸ªreleaseçš„å¯æ‰§è¡ŒåŒ…ï¼Œæ‰‹åŠ¨ç§»åˆ°/urs/local/binä¸‹ã€‚

```shell
# build æ‰“åŒ…é»˜è®¤æ˜¯æ ¹æ®ä½ çš„macç³»ç»Ÿæ‰“åŒ…çš„
swift build --configuration release --product Counter
# æˆ‘ä»¬è¿˜å¯ä»¥å¢åŠ å‚æ•°--build-system [native | xcode] è¿›è¡Œæ‰“åŒ…ï¼Œxcode æ‰“å‡ºæ¥çš„åŒ…é€‚åˆx86å’Œarmç³»ç»Ÿ
swift build --configuration release --build-system xcode --product Counter
cd .build/release/Counter
cp -f Counter /usr/local/bin/counter
```

è¿™æ ·ï¼Œä¸ç®¡åœ¨å“ªï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥æ‰§è¡Œcounterå‘½ä»¤å•¦ï¼

å½“ç„¶å¦‚æœæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬CLIè¿›è¡Œæ¨å¹¿ä½¿ç”¨ï¼Œè‚¯å®šä¸èƒ½åƒä»¥ä¸Šé‚£æ ·è¿›è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥è¿›è¡Œä»¥ä¸‹çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼š

1ã€å†™ä¸€ä¸ªè‡ªåŠ¨å®‰è£…è„šæœ¬ï¼Œä¸‹è½½å·²ç»æ‰“å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åå°†å¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°/usr/local/bin/ç›®å½•ä¸‹

2ã€æˆ‘ä»¬å¯ä»¥åˆ¶ä½œhome brew é€šè¿‡home brew è‡ªåŠ¨å®Œæˆå®‰è£…ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š[åˆ›å»ºä¸‰æ–¹home brew](https://haoxiansen.github.io/2023/02/03/%E5%88%9B%E5%BB%BA%E4%B8%89%E6%96%B9homeBrew.html)



#### ç»“æŸè¯­ï¼ˆé¸¡æ±¤æ¥ä¸€ç¢—~ï¼‰

å¾€å¾€æœ‰äº›äº‹æƒ…è¶…å‡ºäº†æˆ‘ä»¬äº†è§£çš„èŒƒå›´ä¹‹åï¼Œæˆ‘ä»¬å†…å¿ƒæ˜¯æœ‰äº›é™Œç”Ÿã€ä¸€å¤´é›¾æ°´ã€æŠ—æ‹’çš„ï¼Œä½†æ˜¯åªè¦ä½ æ²‰ä¸‹å¿ƒæ¥ï¼Œå»ä»¥ä¸€é¢—å­¦ä¹ çš„å¿ƒï¼Œå»äº†è§£ï¼Œå»å­¦ä¹ ï¼Œé‚£ä¹ˆå°±æ‰“å¼€ä¸€ä¸ªæ–°ä¸–ç•Œã€‚

å¼„æ¸…æ¥šä»¥ä¸Šè¿™äº›ä¹‹åï¼Œå›å¤´åœ¨çœ‹swiftLintä»£ç ï¼Œä¹Ÿå˜å¾—å®¹æ˜“å¤šäº†ã€‚å¥½äº†ï¼Œæ¥ç€å­¦ä¹ swiftlintå®ç°å»äº†~



#### å‚è€ƒ

https://blog.csdn.net/Desgard_Duan/article/details/111878243

https://www.avanderlee.com/swift/command-line-tool-package-manager/

https://developer.apple.com/documentation/packagedescription

https://github.com/apple/swift-argument-parser

https://apple.github.io/swift-argument-parser/documentation/argumentparser/gettingstarted/

